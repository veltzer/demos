<!--
	An example of an observable pattern in Java.
	The observable object is written with observation in mind.
	That is why it is called "active".

				Mark Veltzer

	TODO:
	- this code is UGLY! the "this.listeners[l]=l" pattern is UGLY!
	Unfortunately I cannot change it since it breaks weirdly (doesn't
	find the "notify" method. Investigate and report...
-->
<script>
	function Person(name,age) {
		this.name=name;
		this.age=age;
		this.listeners={};
	}
	Person.prototype.notifyChanges=function(data) {
		for(var i in this.listeners) {
			this.listeners[i].notify(data);
		}
	}
	Person.prototype.addListener=function(l) {
		this.listeners[l]=l;
	}
	Person.prototype.removeListener=function(l) {
		delete this.listeners[l];
	}
	Person.prototype.setName=function(newname) {
		this.name=newname;
		this.notifyChanges(newname);
	}
	// here comes the listener
	function Listener(name) {
		this.name=name;
	}
	Listener.prototype.notify=function(newname) {
		document.write(this.name+' received event about name change to '+newname+'</br>');
	}
	Listener.prototype.toString=function() {
		return this.name;
	}
	var p=new Person('mark',435);
	var l1=new Listener('first listener');
	var l2=new Listener('second listener');
	p.addListener(l1);
	p.addListener(l2);
	p.setName('shay');
	p.removeListener(l1);
	p.setName('doron');
</script>
