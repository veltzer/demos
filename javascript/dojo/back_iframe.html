<!--
	This is a solution to the dojo.back exercise from the exercises.txt file.
	Have a look at it to see the requirements.
	This can also be used as an example of how to use the dojo.back API.

	Mark Veltzer <mark.veltzer@gmail.com>
-->
<html>
<head>
	<title>Hello World</title>

	<script src="../toolkits/dojo/dojo/dojo.js" djConfig="parseOnLoad:true,preventBackButtonFix:false"></script>
	<style type="text/css">
		@import "../toolkits/dojo/dijit/themes/tundra/tundra.css";
		@import "../toolkits/dojo/dojo/resources/dojo.css";
	</style>
	<script>
		dojo.require("dijit.form.Button");
		dojo.require("dijit.form.TextBox");
		dojo.require("dojo.back");
	
		var states=[];
		var index=0;
		var frm;
		function MyState(p_url) {
			this.p_url=p_url;
			this.p_id=index;
			index++;
			states.push(this);
		}
		MyState.prototype.restoreState=function() {
			//alert("restoring "+this.p_url);
			var i=this.p_id;
			if(i>0) {
				//alert("restoring to "+i);
				i--;
				var s=states[i];
				//frm.src=s.p_url;
				frm.src="http://www.sourceforge.net";
			} else {
				frm.src=this.p_url;
			}
		}
		MyState.prototype.back=MyState.prototype.restoreState;
		MyState.prototype.forward=MyState.prototype.restoreState;
		// global to hold the iframe...
		var mybool=false;
		function myinit() {
			frm=document.createElement("iframe");
			var mydiv=document.getElementById("mydiv");
			mydiv.appendChild(frm);
			frm.onload=function() {
				alert("loaded "+frm.src);
				if(frm.src=="http://www.gnu.org/" && mybool) {
					frm.src="http://www.sourceforge.net";
					//window.location.href="http://www.sourceforge.net";
				}
				mybool=true;
			}
			var s=new MyState("http://www.gnu.org");
			dojo.back.setInitialState(s);
			s.restoreState();
		}
		function go() {
			var w_url = dijit.byId("id_url");
			var v_url=w_url.attr('value');
			//alert("going to "+v_url);
			var s=new MyState(v_url);
			dojo.back.addToHistory(s);
			frm.src=v_url;
		}
		dojo.addOnLoad(myinit);
</script>
</head>
	<body class="tundra">
	<!-- this is a fix for IE -->
	<script>
		dojo.back.init()
	</script>
	<div id="mydiv">
	</div>
	<br/>
	<div id="id_url" dojoType="dijit.form.TextBox"></div>
	<br/>
	<div dojoType="dijit.form.Button" onClick="go">go</div>
	<br/>
</html>
